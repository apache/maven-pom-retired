<!DOCTYPE xwork PUBLIC "-//OpenSymphony Group//XWork 1.1.1//EN" "http://www.opensymphony.com/xwork/xwork-1.1.1.dtd">

<xwork>
  <include file="webwork-default.xml"/>

  <!-- Include plexus-security xwork configurations. -->
  <include file="xwork-security.xml"/>


  <package name="default" extends="webwork-default">

    <interceptors>
      <interceptor name="exception-logging" class="exceptionLogging"/>
      <interceptor name="continuumConfigurationCheck" class="forceContinuumConfigurationInterceptor"/>
      <interceptor name="pssForceAdminUser" class="pssForceAdminUserInterceptor"/>
      <interceptor name="pssSecureActions" class="pssSecureActionInterceptor"/>
      <interceptor name="pssAutoLogin" class="pssAutoLoginInterceptor"/>
      <interceptor name="pssEnvironmentChecker" class="pssEnvironmentCheckInterceptor"/>

      <interceptor-stack name="configuredContinuumStack">
        <interceptor-ref name="defaultStack"/>
        <interceptor-ref name="exception-logging"/>
        <interceptor-ref name="pssEnvironmentChecker"/>
        <interceptor-ref name="pssForceAdminUser"/>
        <interceptor-ref name="pssAutoLogin"/>
        <interceptor-ref name="pssSecureActions"/>
        <interceptor-ref name="continuumConfigurationCheck"/>
        <interceptor-ref name="validation">
          <param name="excludeMethods">input,back,cancel,browse,edit</param>
        </interceptor-ref>
        <interceptor-ref name="workflow">
          <param name="excludeMethods">input,back,cancel,browse,edit</param>
        </interceptor-ref>
      </interceptor-stack>

      <interceptor-stack name="unconfiguredContinuumStack">
        <interceptor-ref name="defaultStack"/>
        <interceptor-ref name="exception-logging"/>
        <interceptor-ref name="pssEnvironmentChecker"/>
        <interceptor-ref name="pssForceAdminUser"/>
        <interceptor-ref name="pssAutoLogin"/>
        <interceptor-ref name="pssSecureActions"/>
        <interceptor-ref name="validation">
          <param name="excludeMethods">input,back,cancel,browse,edit</param>
        </interceptor-ref>
        <interceptor-ref name="workflow">
          <param name="excludeMethods">input,back,cancel,browse,edit</param>
        </interceptor-ref>
      </interceptor-stack>
    </interceptors>

    <default-interceptor-ref name="configuredContinuumStack"/>

    <global-results>

      <result name="error">/WEB-INF/jsp/error.jsp</result>
      <result name="internal-error">/WEB-INF/jsp/error.jsp</result>
      <result name="internalError" type="redirect">/WEB-INF/jsp/error.jsp</result>

      <result name="continuum-configuration-required" type="redirect-action">
        <param name="actionName">configuration</param>
        <param name="namespace">/admin</param>
        <param name="method">input</param>
      </result>

      <!-- The following security-* result names arrive from the plexus-security package -->
      <result name="security-login-success" type="redirect-action">
        <param name="actionName">groupSummary</param>
        <param name="namespace">/</param>
      </result>
      <result name="security-login-cancel" type="redirect-action">
        <param name="actionName">groupSummary</param>
        <param name="namespace">/</param>
      </result>
      <result name="security-login-locked" type="redirect-action">
        <param name="actionName">groupSummary</param>
        <param name="namespace">/</param>
        <param name="infoMessage">Account Locked</param>
      </result>
      <result name="security-logout" type="redirect-action">
        <param name="actionName">groupSummary</param>
        <param name="namespace">/</param>
      </result>
      <result name="requires-authentication" type="redirect-action">
        <param name="actionName">login</param>
        <param name="namespace">/security</param>
      </result>
      <result name="security-register-success" type="redirect-action">
        <param name="actionName">login</param>
        <param name="namespace">/security</param>
      </result>
      <result name="security-register-cancel" type="redirect-action">
        <param name="actionName">groupSummary</param>
        <param name="namespace">/</param>
      </result>
      <result name="security-account-success" type="redirect-action">
        <param name="actionName">groupSummary</param>
        <param name="namespace">/</param>
      </result>
      <result name="security-account-cancel" type="redirect-action">
        <param name="actionName">login</param>
        <param name="namespace">/security</param>
      </result>
      <result name="security-admin-user-created" type="redirect-action">
        <param name="actionName">login</param>
        <param name="namespace">/security</param>
      </result>
      <result name="security-admin-user-needed" type="redirect-action">
        <param name="actionName">addadmin</param>
        <param name="namespace">/security</param>
      </result>
    </global-results>

    <global-exception-mappings>
      <exception-mapping exception="org.apache.maven.continuum.initialization.ContinuumInitializationException"
                         result="continuumInitialization"/>
      <!-- TODO: this is missing
            <exception-mapping exception="java.lang.Exception" result="error-internal"/>
      -->
    </global-exception-mappings>

    <!-- This is the redirection facility for plexus-security,
             allowing plexus-security to call out from its own set of actions
             into the application webapp, using global result names. -->
    <action name="pssRedirect" class="pss-redirect" method="redirect">
      <result type="redirect-action">groupSummary</result>
    </action>

    <action name="about" class="about">
      <result name="success">/WEB-INF/jsp/about.jsp</result>
    </action>


    <action name="companyInfo" class="companyInfo">
      <result name="success">/WEB-INF/jsp/components/companyLogo.jsp</result>
    </action>

    <action name="groupSummary" class="groupSummary">
      <result name="success">/WEB-INF/jsp/groupSummary.jsp</result>
    </action>

    <action name="addMavenTwoProject" class="addMavenTwoProject">
      <result name="input">/WEB-INF/jsp/addMavenTwoProject.jsp</result>
      <result name="success" type="chain">groupSummary</result>
    </action>

    <action name="addMavenOneProject" class="addMavenOneProject">
      <result name="input">/WEB-INF/jsp/addMavenOneProject.jsp</result>
      <result name="success" type="chain">groupSummary</result>
    </action>

    <action name="addProjectInput" class="addProject" method="input">
      <result name="success">/WEB-INF/jsp/addProject.jsp</result>
    </action>

    <action name="addProject" class="addProject" method="add">
      <result name="input">/WEB-INF/jsp/addProject.jsp</result>
      <result name="success" type="chain">groupSummary</result>
    </action>

    <action name="deleteProject" class="deleteProject">
      <result name="delete">/WEB-INF/jsp/deleteProject.jsp</result>
      <result name="success" type="chain">groupSummary</result>
    </action>

    <action name="buildProject" class="buildProject">
      <result name="success" type="chain">groupSummary</result>
    </action>

    <action name="projectView" class="projectView">
      <result name="success">/WEB-INF/jsp/projectView.jsp</result>
    </action>

    <action name="projectEdit" class="projectEdit" method="edit">
      <result name="success">/WEB-INF/jsp/projectEdit.jsp</result>
    </action>

    <action name="projectSave" class="projectEdit" method="save">
      <result name="input">/WEB-INF/jsp/projectEdit.jsp</result>
      <result name="success" type="chain">projectView</result>
    </action>

    <!--
    * build definition actions
    -->
    <action name="buildDefinition" class="buildDefinition" method="input">
      <result name="success">/WEB-INF/jsp/buildDefinitionEdit.jsp</result>
    </action>

    <action name="saveBuildDefinition" class="buildDefinition" method="saveBuildDefinition">
      <result name="success" type="chain">projectView</result>
      <result name="success_group" type="chain">projectGroupBuildDefinition</result>
    </action>

    <action name="saveProjectBuildDefinition" class="buildDefinition" method="saveToProject">
      <result name="input">/WEB-INF/jsp/buildDefinitionEdit.jsp</result>
      <result name="success" type="chain">projectView</result>
    </action>

    <action name="removeProjectBuildDefinition" class="buildDefinition" method="removeFromProject">
      <result name="confirm">/WEB-INF/jsp/deleteBuildDefinition.jsp</result>
      <result name="success" type="chain">projectView</result>
    </action>

    <action name="saveGroupBuildDefinition" class="buildDefinition" method="saveToGroup">
      <result name="success" type="chain">projectGroupBuildDefinition</result>
    </action>

    <action name="removeGroupBuildDefinition" class="buildDefinition" method="removeFromProjectGroup">
      <result name="confirm">/WEB-INF/jsp/confirmBuildDefinitionRemoval.jsp</result>
      <result name="success" type="chain">projectGroupBuildDefinition</result>
    </action>


    <!--
    * project group actions
    -->
    <action name="projectGroupSummary" class="projectGroup" method="summary">
      <result name="success">/WEB-INF/jsp/projectGroupSummary.jsp</result>
    </action>

    <action name="projectGroupMembers" class="projectGroup" method="members">
      <result name="success">/WEB-INF/jsp/projectGroupMembers.jsp</result>
    </action>

    <action name="projectGroupBuildDefinition" class="projectGroup" method="buildDefinitions">
      <result name="success">/WEB-INF/jsp/projectGroupBuildDefinition.jsp</result>
    </action>

    <action name="projectGroupNotifier" class="projectGroup" method="notifiers">
      <result name="success">/WEB-INF/jsp/projectGroupNotifier.jsp</result>
    </action>

    <action name="buildProjectGroup" class="projectGroup" method="build">
      <result name="success" type="redirect-action">
        <param name="actionName">projectGroupSummary</param>
        <param name="projectGroupId">${projectGroupId}</param>
      </result>
    </action>

    <action name="removeProjectGroup" class="projectGroup" method="remove">
      <result name="confirm">/WEB-INF/jsp/confirmGroupRemoval.jsp</result>
      <result name="success" type="redirect-action">
        <param name="actionName">groupSummary</param>
      </result>
    </action>

    <action name="addProjectGroup" class="addProjectGroup">
      <result name="input">/WEB-INF/jsp/projectGroupAdd.jsp</result>
      <result name="success" type="chain">groupSummary</result>
    </action>

    <action name="editProjectGroup" class="projectGroup" method="edit">
      <result name="success">/WEB-INF/jsp/projectGroupEdit.jsp</result>
    </action>

    <action name="saveProjectGroup" class="projectGroup" method="save">
      <result name="success" type="chain">projectGroupSummary</result>
      <result name="input">/WEB-INF/jsp/projectGroupEdit.jsp</result>
    </action>

    <!--
    * notifier actions :: Project
    -->
    <action name="deleteProjectNotifier" class="deleteProjectNotifier">
      <result name="delete">/WEB-INF/jsp/deleteNotifier.jsp</result>
      <result name="success" type="chain">projectView</result>
    </action>

    <action name="addProjectNotifier" class="addProjectNotifier" method="doDefault">
      <result name="input">/WEB-INF/jsp/notifierSelectType.jsp</result>
      <result name="mail_input">/WEB-INF/jsp/notifierMail.jsp</result>
      <result name="irc_input">/WEB-INF/jsp/notifierIrc.jsp</result>
      <result name="msn_input">/WEB-INF/jsp/notifierMsn.jsp</result>
      <result name="jabber_input">/WEB-INF/jsp/notifierJabber.jsp</result>
    </action>

    <action name="editProjectNotifier" class="addProjectNotifier">
      <result name="mail_input" type="chain">mailProjectNotifierEdit</result>
      <result name="irc_input" type="chain">ircProjectNotifierEdit</result>
      <result name="msn_input" type="chain">msnProjectNotifierEdit</result>
      <result name="jabber_input" type="chain">jabberProjectNotifierEdit</result>
    </action>

    <action name="mailProjectNotifierEdit" class="mailProjectNotifierEdit" method="edit">
      <result name="success">/WEB-INF/jsp/notifierMail.jsp</result>
    </action>

    <action name="mailProjectNotifierSave" class="mailProjectNotifierEdit" method="save">
      <result name="input">/WEB-INF/jsp/notifierMail.jsp</result>
      <result name="success" type="chain">projectView</result>
    </action>

    <action name="ircProjectNotifierEdit" class="ircProjectNotifierEdit" method="edit">
      <result name="success">/WEB-INF/jsp/notifierIrc.jsp</result>
    </action>

    <action name="ircProjectNotifierSave" class="ircProjectNotifierEdit" method="save">
      <result name="input">/WEB-INF/jsp/notifierIrc.jsp</result>
      <result name="success" type="chain">projectView</result>
    </action>

    <action name="jabberProjectNotifierEdit" class="jabberProjectNotifierEdit" method="edit">
      <result name="success">/WEB-INF/jsp/notifierJabber.jsp</result>
    </action>

    <action name="jabberProjectNotifierSave" class="jabberProjectNotifierEdit" method="save">
      <result name="input">/WEB-INF/jsp/notifierJabber.jsp</result>
      <result name="success" type="chain">projectView</result>
    </action>

    <action name="msnProjectNotifierEdit" class="msnProjectNotifierEdit" method="edit">
      <result name="success">/WEB-INF/jsp/notifierMsn.jsp</result>
    </action>

    <action name="msnProjectNotifierSave" class="msnProjectNotifierEdit" method="save">
      <result name="input">/WEB-INF/jsp/notifierMsn.jsp</result>
      <result name="success" type="chain">projectView</result>
    </action>

    <!--
    * notifier actions :: Project Group
    -->

    <action name="deleteProjectGroupNotifier" class="deleteGroupNotifier">
      <result name="delete">/WEB-INF/jsp/deleteNotifier.jsp</result>
      <result name="success" type="chain">projectGroupNotifier</result>
    </action>

    <action name="addProjectGroupNotifier" class="addGroupNotifier" method="doDefault">
      <result name="input">/WEB-INF/jsp/notifierSelectType.jsp</result>
      <result name="mail_input">/WEB-INF/jsp/notifierMail.jsp</result>
      <result name="irc_input">/WEB-INF/jsp/notifierIrc.jsp</result>
      <result name="msn_input">/WEB-INF/jsp/notifierMsn.jsp</result>
      <result name="jabber_input">/WEB-INF/jsp/notifierJabber.jsp</result>
    </action>

    <action name="editProjectGroupNotifier" class="addGroupNotifier">
      <result name="mail_input" type="chain">mailProjectGroupNotifierEdit</result>
      <result name="irc_input" type="chain">ircProjectGroupNotifierEdit</result>
      <result name="msn_input" type="chain">msnProjectGroupNotifierEdit</result>
      <result name="jabber_input" type="chain">jabberProjectGroupNotifierEdit</result>
    </action>

    <action name="mailProjectGroupNotifierEdit" class="mailGroupNotifierEdit" method="edit">
      <result name="success">/WEB-INF/jsp/notifierMail.jsp</result>
    </action>

    <action name="mailProjectGroupNotifierSave" class="mailGroupNotifierEdit" method="save">
      <result name="input">/WEB-INF/jsp/notifierMail.jsp</result>
      <result name="success" type="chain">projectGroupNotifier</result>
    </action>

    <action name="ircProjectGroupNotifierEdit" class="ircGroupNotifierEdit" method="edit">
      <result name="success">/WEB-INF/jsp/notifierIrc.jsp</result>
    </action>

    <action name="ircProjectGroupNotifierSave" class="ircGroupNotifierEdit" method="save">
      <result name="input">/WEB-INF/jsp/notifierIrc.jsp</result>
      <result name="success" type="chain">projectGroupNotifier</result>
    </action>

    <action name="jabberProjectGroupNotifierEdit" class="jabberGroupNotifierEdit" method="edit">
      <result name="success">/WEB-INF/jsp/notifierJabber.jsp</result>
    </action>

    <action name="jabberProjectGroupNotifierSave" class="jabberGroupNotifierEdit" method="save">
      <result name="input">/WEB-INF/jsp/notifierJabber.jsp</result>
      <result name="success" type="chain">projectGroupNotifier</result>
    </action>

    <action name="msnProjectGroupNotifierEdit" class="msnGroupNotifierEdit" method="edit">
      <result name="success">/WEB-INF/jsp/notifierMsn.jsp</result>
    </action>

    <action name="msnProjectGroupNotifierSave" class="msnGroupNotifierEdit" method="save">
      <result name="input">/WEB-INF/jsp/notifierMsn.jsp</result>
      <result name="success" type="chain">projectGroupNotifier</result>
    </action>

    <!--
    *  build results, test reporting, working copy actions
    -->
    <action name="buildResults" class="buildResults">
      <result name="success">/WEB-INF/jsp/buildResults.jsp</result>
    </action>

    <action name="buildResult" class="buildResult">
      <result name="success">/WEB-INF/jsp/buildResult.jsp</result>
    </action>

    <action name="surefireReport" class="surefireReport">
      <result name="success">/WEB-INF/jsp/surefireReport.jsp</result>
    </action>

    <action name="workingCopy" class="workingCopy">
      <result name="success">/WEB-INF/jsp/workingCopy.jsp</result>
      <result name="stream" type="stream">
        <param name="contentType">application/octet-stream</param>
        <param name="contentDisposition">filename="${downloadFilename}"</param>
        <param name="contentLength">${fileLength}</param>
      </result>
    </action>

    <!--
    * schedule actions
    -->
    <action name="schedules" class="schedule" method="summary">
      <result name="success">/WEB-INF/jsp/schedules.jsp</result>
    </action>

    <action name="schedule" class="schedule" method="input">
      <result name="success">/WEB-INF/jsp/editSchedule.jsp</result>
    </action>

    <action name="saveSchedule" class="schedule" method="save">
      <result name="input">/WEB-INF/jsp/editSchedule.jsp</result>
      <result name="success" type="chain">schedules</result>
      <result name="error" type="chain">schedule</result>
    </action>
    <action name="removeSchedule" class="schedule" method="remove">
      <result name="confirm">/WEB-INF/jsp/confirmation.jsp</result>
      <result name="success" type="chain">schedules</result>
    </action>

    <action name="cancelBuild" class="cancelBuild">
      <result name="success" type="chain">buildResults</result>
    </action>

    <!--
    - continuum release
    -->
    <action name="releasePromptGoal" class="releaseProject" method="promptReleaseGoal">
      <result name="success">/WEB-INF/jsp/releaseProject.jsp</result>
    </action>

    <action name="releaseProject" class="releaseProject">
      <result name="prepareRelease" type="redirect-action">
        <param name="actionName">releasePrepareInput</param>
        <param name="projectId">${projectId}</param>
      </result>
      <result name="performRelease" type="redirect-action">
        <param name="actionName">releasePerformInput</param>
        <param name="projectId">${projectId}</param>
        <param name="releaseId">${preparedReleaseId}</param>
      </result>
      <result name="performReleaseFromScm" type="redirect-action">
        <param name="actionName">releasePerformFromScmInput</param>
        <param name="projectId">${projectId}</param>
      </result>
    </action>

    <action name="releasePrepareInput" class="releasePrepare" method="input">
      <result name="success">/WEB-INF/jsp/releasePrepare.jsp</result>
    </action>

    <action name="releasePrepare" class="releasePrepare">
      <result name="input" type="chain">releasePrepareInput</result>
      <result name="success" type="redirect-action">
        <param name="actionName">releaseInProgress</param>
        <param name="releaseId">${releaseId}</param>
        <param name="projectId">${projectId}</param>
      </result>
    </action>

    <action name="releasePerformInput" class="releasePerform" method="input">
      <result name="success">/WEB-INF/jsp/releasePerform.jsp</result>
    </action>

    <action name="releasePerform" class="releasePerform">
      <result name="input" type="chain">releasePerformInput</result>
      <result name="success" type="redirect-action">
        <param name="actionName">releaseInProgress</param>
        <param name="releaseId">${releaseId}</param>
        <param name="projectId">${projectId}</param>
      </result>
    </action>

    <action name="releasePerformFromScmInput" class="releasePerform" method="inputFromScm">
      <result name="success">/WEB-INF/jsp/releasePerformFromScm.jsp</result>
    </action>

    <action name="releasePerformFromScm" class="releasePerform" method="executeFromScm">
      <result name="input" type="chain">releasePerformFromScmInput</result>
      <result name="success" type="redirect-action">
        <param name="actionName">releaseInProgress</param>
        <param name="projectId">${projectId}</param>
      </result>
    </action>

    <action name="releaseInProgress" class="releaseInProgress">
      <result name="initialized">/WEB-INF/jsp/releaseInitialized.jsp</result>
      <result name="inProgress">/WEB-INF/jsp/releaseInProgress.jsp</result>
      <result name="success">/WEB-INF/jsp/releaseFinished.jsp</result>
    </action>

    <action name="releaseCleanup" class="releaseCleanup">
      <result name="prepareFinished" type="chain">releasePromptGoal</result>
      <result name="performFinished" type="chain">groupSummary</result>
    </action>

    <action name="releaseViewResult" class="releaseInProgress" method="viewResult">
      <result name="success">/WEB-INF/jsp/releaseViewResult.jsp</result>
    </action>

  </package>

  <!--
  |
  | admin actions
  |
  | administrative secured actions ought to be placed in here so there is a clear seperation between secured
  | actions and others
  |
  -->
  <package name="admin" extends="default">

    <action name="configuration" class="configuration">
      <interceptor-ref name="unconfiguredContinuumStack"/>
      <result name="input">/WEB-INF/jsp/admin/configurationEdit.jsp</result>
      <result name="success">/WEB-INF/jsp/admin/configuration.jsp</result>
    </action>

    <action name="configureAppearance" class="configureAppearance" method="input">
      <result name="input">/WEB-INF/jsp/admin/appearance.jsp</result>
    </action>

    <action name="editAppearance" class="configureAppearance" method="input">
      <result name="input">/WEB-INF/jsp/admin/editAppearance.jsp</result>
    </action>

    <action name="saveAppearance" class="configureAppearance">
      <result name="input">/WEB-INF/jsp/admin/editAppearance.jsp</result>
      <result type="redirect-action">
        <param name="actionName">configureAppearance</param>
        <param name="namespace">/admin</param>
      </result>
    </action>

    <action name="editCompanyPom" class="editPom" method="input">
      <result name="input">/WEB-INF/jsp/admin/editPom.jsp</result>
    </action>

    <action name="saveCompanyPom" class="editPom">
      <result name="input">/WEB-INF/jsp/admin/editPom.jsp</result>
      <result type="redirect-action">
        <param name="actionName">configureAppearance</param>
        <param name="namespace">/admin</param>
      </result>
    </action>
  </package>

  <package name="component" extends="default">
    <!--
    * component actions
    -->
    <action name="buildDefinitionSummary" class="buildDefinitionSummary" method="summarizeForProject">
      <result name="success">/WEB-INF/jsp/components/buildDefinitionSummaryComponent.jsp</result>
      <result name="error">/WEB-INF/jsp/components/failureComponent.jsp</result>
    </action>

    <action name="groupBuildDefinitionSummary" class="buildDefinitionSummary" method="summarizeForGroup">
      <result name="success">/WEB-INF/jsp/components/buildDefinitionGroupSummaryComponent.jsp</result>
      <result name="error">/WEB-INF/jsp/components/failureComponent.jsp</result>
    </action>

    <action name="projectGroupTab" class="continuumTab">
      <result name="success">/WEB-INF/jsp/components/projectGroupTabComponent.jsp</result>
      <result name="error">/WEB-INF/jsp/components/failureComponent.jsp</result>
    </action>

    <action name="projectSummary" class="summary">
      <result name="success">/WEB-INF/jsp/components/projectSummaryComponent.jsp</result>
      <result name="error">/WEB-INF/jsp/components/failureComponent.jsp</result>
    </action>

    <action name="projectNotifierSummary" class="notifierSummary" method="summarizeForProject">
      <result name="success">/WEB-INF/jsp/components/projectNotifierSummaryComponent.jsp</result>
      <result name="error">/WEB-INF/jsp/components/failureComponent.jsp</result>
    </action>

    <action name="projectGroupNotifierSummary" class="notifierSummary" method="summarizeForProjectGroup">
      <result name="success">/WEB-INF/jsp/components/projectGroupNotifierSummaryComponent.jsp</result>
      <result name="error">/WEB-INF/jsp/components/failureComponent.jsp</result>
    </action>

  </package>
</xwork>
